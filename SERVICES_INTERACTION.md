# üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ BookingProject

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏.
| –£—Ä–æ–≤–µ–Ω—å           | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç                   | –ì–¥–µ                          |
| ----------------- | ------------------------------- | ---------------------------- |
| Unit tests        | —Å–µ—Ä–≤–∏—Å—ã, –º–∞–ø–ø–µ—Ä—ã, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ | JUnit                        |
| Slice tests       | Controller / Repository         | @WebMvcTest, @DataJpaTest    |
| Integration tests | –ë–î, Kafka, Redis, gRPC          | Testcontainers               |
| Contract tests    | API / —Å–æ–±—ã—Ç–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏   | Pact / Spring Cloud Contract |


| –¢–∏–ø                            | –ù—É–∂–Ω–æ         |
| ------------------------------ | ------------- |
| Unit                           | ‚úÖ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
| Controller slice               | ‚úÖ             |
| Repository                     | ‚úÖ             |
| Integration (Postgres + Kafka) | ‚úÖ             |
| Contract                       | ‚è≥ –ø–æ—Ç–æ–º       |

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
- [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
- [–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#–ø—Ä–æ—Ç–æ–∫–æ–ª—ã-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
- [–î–µ—Ç–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ](#–¥–µ—Ç–∞–ª—å–Ω–æ–µ-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
- [–°–æ–±—ã—Ç–∏—è Kafka](#—Å–æ–±—ã—Ç–∏—è-kafka)
- [–û—Å–Ω–æ–≤–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å](#–æ—Å–Ω–æ–≤–Ω–æ–π-–±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å)

---

## üèó –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **event-driven** –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –¥–æ–º–µ–Ω–Ω—É—é –æ–±–ª–∞—Å—Ç—å
- **–°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å**: —Å–µ—Ä–≤–∏—Å—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ REST API –∏ —Å–æ–±—ã—Ç–∏—è Kafka
- **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã

---

## üéØ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

### 1. üîê **API Gateway** (`api-gateway`)
**–ü–æ—Ä—Ç**: 8080

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (Keycloak)
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- –ü—Ä–æ–±—Ä–æ—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (userId, roles) –≤ downstream-—Å–µ—Ä–≤–∏—Å—ã

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º

---

### 2. üöå **Trip Service** (`trip-service`)
**–ü–æ—Ä—Ç**: 8086

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏ (trips)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ (routes)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–æ–≤
- –°—Ç–∞—Ç—É—Å—ã —Ä–µ–π—Å–æ–≤ (SCHEDULED, IN_PROGRESS, CANCELLED, COMPLETED)

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /trips` - –ø–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã: from, to, date)
- `GET /trips/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–π—Å–µ
- `POST /trips` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–∞ (—Ç–æ–ª—å–∫–æ ADMIN)
- `PUT /trips/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞ (—Ç–æ–ª—å–∫–æ ADMIN)
- `DELETE /trips/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞ (—Ç–æ–ª—å–∫–æ ADMIN)

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:
- **–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è**:
  - `trip.created` ‚Üí —Å–ª—É—à–∞–µ—Ç `inventory-service`
  - `trip.cancelled` ‚Üí —Å–ª—É—à–∞–µ—Ç `inventory-service`
  - `trip.departed` ‚Üí —Å–ª—É—à–∞–µ—Ç `inventory-service`
  - `trip.updated` ‚Üí –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

- **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç**:
  - `booking-service` (REST) - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–π—Å–µ –∏ —Ü–µ–Ω–µ

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL

---

### 3. üé´ **Booking Service** (`booking-service`)
**–ü–æ—Ä—Ç**: 8081

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/bookings` - —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/v1/bookings/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/v1/bookings` - —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- `PUT /api/v1/bookings/{id}/cancel` - –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:

**–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã (REST)**:
- ‚Üí `trip-service`: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–π—Å–µ –∏ —Ü–µ–Ω–µ
- ‚Üí `order-service`: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞, –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞
- ‚Üí `payment-service`: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏

**–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã (gRPC)**:
- ‚Üí `inventory-service`: —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏

**–°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `payment.succeeded` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CONFIRMED
- `payment.failed` ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `order.cancelled` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CANCELLED

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL

---

### 4. üì¶ **Inventory Service** (`inventory-service`)
**–ü–æ—Ä—Ç**: 8080 (HTTP), 9090 (gRPC)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞–º–∏ –≤ –∞–≤—Ç–æ–±—É—Å–∞—Ö
- –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç —Å TTL (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL

**–°—Ç–∞—Ç—É—Å—ã –º–µ—Å—Ç**:
- `AVAILABLE` - —Å–≤–æ–±–æ–¥–Ω–æ
- `RESERVED` - –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ
- `SOLD` - –ø—Ä–æ–¥–∞–Ω–æ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)
- `CANCELLED` - –æ—Ç–º–µ–Ω–µ–Ω–æ

**gRPC –º–µ—Ç–æ–¥—ã**:
- `ReserveSeats` - —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç
- `ReleaseReservation` - –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏
- `ConfirmReservation` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:

**–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (gRPC)**:
- ‚Üê `booking-service`: —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç
- ‚Üê `order-service`: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π

**–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (REST)**:
- `GET /api/v1/seats/trip/{tripId}` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–µ—Å—Ç

**–°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `trip.created` ‚Üí —Å–æ–∑–¥–∞–µ—Ç –º–µ—Å—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ–π—Å–∞
- `trip.cancelled` ‚Üí –ø–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –º–µ—Å—Ç–∞ –∫–∞–∫ CANCELLED
- `trip.departed` ‚Üí –ø–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –º–µ—Å—Ç–∞ –∫–∞–∫ SOLD

**–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `reservation.expired` ‚Üí –∫–æ–≥–¥–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è –∏—Å—Ç–µ–∫–ª–∞ –ø–æ TTL

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (–º–µ—Å—Ç–∞), Redis (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ —Å TTL)

---

### 5. üßæ **Order Service** (`order-service`)
**–ü–æ—Ä—Ç**: 8082

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞–∫–∞–∑–æ–≤
- –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ–ø–ª–∞—Ç–æ–π –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞**:
- `PENDING` - –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `CONFIRMED` - –æ–ø–ª–∞—á–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- `CANCELLED` - –æ—Ç–º–µ–Ω–µ–Ω

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/orders` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `GET /api/v1/orders/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `GET /api/v1/orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- `PUT /api/v1/orders/{id}/confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `PUT /api/v1/orders/{id}/cancel` - –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:

**–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (REST)**:
- ‚Üê `booking-service`: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

**–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã (gRPC)**:
- ‚Üí `inventory-service`: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π

**–°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `payment.succeeded` ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- `payment.failed` ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- `reservation.expired` ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –≤ —Å—Ç–∞—Ç—É—Å–µ PENDING

**–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `order.created` ‚Üí –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
- `order.confirmed` ‚Üí –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- `order.cancelled` ‚Üí –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL

---

### 6. üí≥ **Payment Service** (`payment-service`)
**–ü–æ—Ä—Ç**: 8085

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Stripe –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–µ—Å—Å–∏–π (Stripe Checkout)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ Stripe Webhook'–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –ø–ª–∞—Ç–µ–∂–µ–π

**–°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–∞**:
- `PENDING` - –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `SUCCEEDED` - —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω
- `FAILED` - –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/payments` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏
- `GET /api/v1/payments/status/{orderId}` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
- `POST /api/v1/payments/stripe` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ Stripe Webhook

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:

**–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (REST)**:
- ‚Üê `booking-service`: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏

**–í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
- ‚Üí `Stripe API`: —Å–æ–∑–¥–∞–Ω–∏–µ Checkout Session, –æ–±—Ä–∞–±–æ—Ç–∫–∞ Webhook'–æ–≤

**–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è Kafka**:
- `payment.succeeded` ‚Üí –∫–æ–≥–¥–∞ –ø–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
- `payment.failed` ‚Üí –∫–æ–≥–¥–∞ –ø–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL

---

### 7. üë§ **User Service** (`user-service`)
**–ü–æ—Ä—Ç**: 8084

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Keycloak)

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /api/v1/users/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- `PUT /api/v1/users/me` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `GET /api/v1/users/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (ADMIN)

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Keycloak –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL

---

## üîå –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

| –°–≤—è–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------------|----------|------------|
| Booking ‚Üî Trip | REST (WebClient) | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–π—Å–µ –∏ —Ü–µ–Ω–µ |
| Booking ‚Üî Inventory | gRPC | –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç |
| Booking ‚Üî Order | REST (WebClient) | –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤ |
| Booking ‚Üî Payment | REST (WebClient) | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏ |
| Order ‚Üî Inventory | gRPC | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π |
| Payment ‚Üî Stripe | REST (Stripe API) | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π |
| –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã ‚Üî Kafka | Kafka Events | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è |

---

## üîÑ –î–µ—Ç–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

### 1. Booking Service ‚Üî Trip Service

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Booking ‚Üí Trip (REST)

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å**:
```http
GET /trips/{tripId}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "id": "uuid",
  "price": 25.50,
  "status": "SCHEDULED",
  ...
}
```

**–õ–æ–≥–∏–∫–∞**:
- Booking Service –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–π—Å–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ä–µ–π—Å–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `SCHEDULED`)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞

---

### 2. Booking Service ‚Üî Inventory Service

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Booking ‚Üí Inventory (gRPC)

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–µ—Å—Ç

**gRPC –º–µ—Ç–æ–¥**: `ReserveSeats`

**–ó–∞–ø—Ä–æ—Å**:
```protobuf
message ReserveSeatsRequest {
  string trip_id = 1;
  int32 seats_count = 2;
}
```

**–û—Ç–≤–µ—Ç**:
```protobuf
message ReserveSeatsResponse {
  string reservation_id = 1;
  string expires_at = 2;
}
```

**–õ–æ–≥–∏–∫–∞**:
- Inventory Service —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç
- –°–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –≤ Redis —Å TTL (–æ–±—ã—á–Ω–æ 15 –º–∏–Ω—É—Ç)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `reservationId` –∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ (rollback)

**gRPC –º–µ—Ç–æ–¥**: `ReleaseReservation`

**–ó–∞–ø—Ä–æ—Å**:
```protobuf
message ReleaseReservationRequest {
  string reservation_id = 1;
}
```

---

### 3. Booking Service ‚Üî Order Service

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Booking ‚Üí Order (REST)

**–ö–æ–≥–¥–∞**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç

**–ó–∞–ø—Ä–æ—Å**:
```http
POST /api/v1/orders
Content-Type: application/json

{
  "userId": "uuid",
  "tripId": "uuid",
  "reservationId": "uuid",
  "price": 25.50,
  "seatsCount": 2
}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "id": "uuid",
  "totalPrice": 51.00,
  "status": "PENDING",
  ...
}
```

**–õ–æ–≥–∏–∫–∞**:
- Order Service —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING`
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç `totalPrice = price * seatsCount`
- –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `order.created`

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å**:
```http
PUT /api/v1/orders/{orderId}/cancel
```

---

### 4. Booking Service ‚Üî Payment Service

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Booking ‚Üí Payment (REST)

**–ö–æ–≥–¥–∞**: –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

**–ó–∞–ø—Ä–æ—Å**:
```http
POST /api/v1/payments
Content-Type: application/json

{
  "orderId": "uuid",
  "amount": 51.00,
  "currency": "usd",
  "description": "Payment for order #uuid"
}
```

**–û—Ç–≤–µ—Ç**: `String` (URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ Stripe Checkout)

**–õ–æ–≥–∏–∫–∞**:
- Payment Service —Å–æ–∑–¥–∞–µ—Ç Stripe Checkout Session
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã

---

### 5. Order Service ‚Üî Inventory Service

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Order ‚Üí Inventory (gRPC)

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã)

**gRPC –º–µ—Ç–æ–¥**: `ConfirmReservation`

**–õ–æ–≥–∏–∫–∞**:
- Order Service –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- Inventory Service –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–µ—Å—Ç —Å `RESERVED` –Ω–∞ `SOLD`
- –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –∏–∑ Redis

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞

**gRPC –º–µ—Ç–æ–¥**: `ReleaseReservation`

**–õ–æ–≥–∏–∫–∞**:
- Order Service –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- Inventory Service –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–µ—Å—Ç —Å `RESERVED` –Ω–∞ `AVAILABLE`
- –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –∏–∑ Redis

---

### 6. Payment Service ‚Üî Stripe

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Payment ‚Üí Stripe (REST API)

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

**–î–µ–π—Å—Ç–≤–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ Stripe Checkout Session

**–ö–æ–≥–¥–∞**: –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ Webhook –æ—Ç Stripe

**–≠–Ω–¥–ø–æ–∏–Ω—Ç**: `POST /api/v1/payments/stripe`

**–°–æ–±—ã—Ç–∏—è Stripe**:
- `payment_intent.succeeded` ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç `payment.succeeded` –≤ Kafka
- `payment_intent.payment_failed` ‚Üí –ø—É–±–ª–∏–∫—É–µ—Ç `payment.failed` –≤ Kafka

---

## üì® –°–æ–±—ã—Ç–∏—è Kafka

### –¢–æ–ø–∏–∫–∏ –∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏

#### `trip.created`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `trip-service`  
**–°–ª—É—à–∞–µ—Ç**: `inventory-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
TripCreatedEvent(
    UUID eventId,
    UUID tripId,
    BusType busType,
    Instant createdAt
)
```

**–î–µ–π—Å—Ç–≤–∏–µ**: Inventory Service —Å–æ–∑–¥–∞–µ—Ç –º–µ—Å—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ–π—Å–∞

---

#### `trip.cancelled`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `trip-service`  
**–°–ª—É—à–∞–µ—Ç**: `inventory-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
TripCancelledEvent(
    UUID eventId,
    UUID tripId,
    Instant cancelledAt
)
```

**–î–µ–π—Å—Ç–≤–∏–µ**: Inventory Service –ø–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –º–µ—Å—Ç–∞ –∫–∞–∫ `CANCELLED`

---

#### `trip.departed`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `trip-service`  
**–°–ª—É—à–∞–µ—Ç**: `inventory-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
TripDepartedEvent(
    UUID eventId,
    UUID tripId,
    Instant departedAt
)
```

**–î–µ–π—Å—Ç–≤–∏–µ**: Inventory Service –ø–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –º–µ—Å—Ç–∞ –∫–∞–∫ `SOLD`

---

#### `reservation.expired`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `inventory-service`  
**–°–ª—É—à–∞–µ—Ç**: `order-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
ReservationExpiredEvent(
    UUID eventId,
    UUID reservationId,
    UUID tripId,
    Instant expiredAt
)
```

**–î–µ–π—Å—Ç–≤–∏–µ**: Order Service –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –≤ —Å—Ç–∞—Ç—É—Å–µ `PENDING`

---

#### `order.created`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `order-service`  
**–°–ª—É—à–∞–µ—Ç**: (–¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π - notification-service –∏ —Ç.–¥.)

**–°–æ–±—ã—Ç–∏–µ**:
```java
OrderCreatedEvent(
    UUID eventId,
    UUID orderId,
    Instant createdAt
)
```

---

#### `order.confirmed`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `order-service`  
**–°–ª—É—à–∞–µ—Ç**: (–¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π - notification-service –∏ —Ç.–¥.)

**–°–æ–±—ã—Ç–∏–µ**:
```java
OrderConfirmedEvent(
    UUID eventId,
    UUID orderId,
    Instant confirmedAt
)
```

---

#### `order.cancelled`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `order-service`  
**–°–ª—É—à–∞–µ—Ç**: `booking-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
OrderCancelledEvent(
    UUID eventId,
    UUID orderId,
    Instant cancelledAt
)
```

**–î–µ–π—Å—Ç–≤–∏–µ**: Booking Service –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ `CANCELLED`

---

#### `payment.succeeded`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `payment-service`  
**–°–ª—É—à–∞–µ—Ç**: `order-service`, `booking-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
PaymentSucceededEvent(
    UUID eventId,
    UUID orderId,
    UUID paymentId,
    Instant paidAt
)
```

**–î–µ–π—Å—Ç–≤–∏—è**:
- Order Service –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- Booking Service –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ `CONFIRMED`

---

#### `payment.failed`
**–ü—É–±–ª–∏–∫—É–µ—Ç**: `payment-service`  
**–°–ª—É—à–∞–µ—Ç**: `order-service`, `booking-service`

**–°–æ–±—ã—Ç–∏–µ**:
```java
PaymentFailedEvent(
    UUID eventId,
    UUID orderId,
    String reason,
    Instant failedAt
)
```

**–î–µ–π—Å—Ç–≤–∏—è**:
- Order Service –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é
- Booking Service –æ—Ç–º–µ–Ω—è–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üé¨ –û—Å–Ω–æ–≤–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å

### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø–ª–∞—Ç—ã

```
1. [Client] ‚Üí [API Gateway] ‚Üí [Booking Service]
   POST /api/v1/bookings
   {
     "tripId": "uuid",
     "seatsCount": 2
   }

2. [Booking Service] ‚Üí [Trip Service] (REST)
   GET /trips/{tripId}
   ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ä–µ–π—Å–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å SCHEDULED)
   ‚Üí –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–Ω—É –±–∏–ª–µ—Ç–∞

3. [Booking Service] ‚Üí [Inventory Service] (gRPC)
   ReserveSeats(tripId, seatsCount)
   ‚Üí –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –º–µ—Å—Ç–∞ (—Å—Ç–∞—Ç—É—Å RESERVED)
   ‚Üí –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –≤ Redis —Å TTL (15 –º–∏–Ω—É—Ç)
   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç reservationId –∏ expiresAt

4. [Booking Service] ‚Üí [Order Service] (REST)
   POST /api/v1/orders
   {
     "userId": "uuid",
     "tripId": "uuid",
     "reservationId": "uuid",
     "price": 25.50,
     "seatsCount": 2
   }
   ‚Üí –°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º PENDING
   ‚Üí –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç totalPrice = 51.00
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ order.created

5. [Booking Service] ‚Üí [Payment Service] (REST)
   POST /api/v1/payments
   {
     "orderId": "uuid",
     "amount": 51.00,
     "currency": "usd",
     "description": "Payment for order #uuid"
   }
   ‚Üí –°–æ–∑–¥–∞–µ—Ç Stripe Checkout Session
   ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞—Ç–µ–∂ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º PENDING
   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

6. [Booking Service] ‚Üí [Client]
   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
   {
     "bookingId": "uuid",
     "orderId": "uuid",
     "paymentUrl": "https://checkout.stripe.com/...",
     "expiresAt": "2025-01-27T12:30:00Z"
   }

7. [Client] ‚Üí [Stripe Checkout]
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç

8. [Stripe] ‚Üí [Payment Service] (Webhook)
   POST /api/v1/payments/stripe
   Event: payment_intent.succeeded
   ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ SUCCEEDED
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ payment.succeeded –≤ Kafka

9. [Kafka] ‚Üí [Order Service] (—Å–ª—É—à–∞–µ—Ç payment.succeeded)
   ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ (—Å—Ç–∞—Ç—É—Å CONFIRMED)
   ‚Üí [Order Service] ‚Üí [Inventory Service] (gRPC)
     ConfirmReservation(reservationId)
     ‚Üí –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–µ—Å—Ç –Ω–∞ SOLD
     ‚Üí –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –∏–∑ Redis
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ order.confirmed

10. [Kafka] ‚Üí [Booking Service] (—Å–ª—É—à–∞–µ—Ç payment.succeeded)
    ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CONFIRMED
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
1. [Client] ‚Üí [API Gateway] ‚Üí [Booking Service]
   PUT /api/v1/bookings/{id}/cancel

2. [Booking Service] ‚Üí [Inventory Service] (gRPC)
   ReleaseReservation(reservationId)
   ‚Üí –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–∞ (—Å—Ç–∞—Ç—É—Å AVAILABLE)
   ‚Üí –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –∏–∑ Redis

3. [Booking Service] ‚Üí [Order Service] (REST)
   PUT /api/v1/orders/{orderId}/cancel
   ‚Üí –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ order.cancelled

4. [Booking Service]
   ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CANCELLED
```

### –ü—Ä–æ—Ü–µ—Å—Å –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ (TTL)

```
1. [Redis TTL –∏—Å—Ç–µ–∫–∞–µ—Ç] ‚Üí [Inventory Service]
   ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–µ—Å—Ç–∞
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ reservation.expired

2. [Kafka] ‚Üí [Order Service] (—Å–ª—É—à–∞–µ—Ç reservation.expired)
   ‚Üí –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –≤ —Å—Ç–∞—Ç—É—Å–µ PENDING
   ‚Üí –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ order.cancelled

3. [Kafka] ‚Üí [Booking Service] (—Å–ª—É—à–∞–µ—Ç order.cancelled)
   ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CANCELLED
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ **API Gateway**, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω –æ—Ç Keycloak
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç `userId` –∏ `roles` –∏–∑ —Ç–æ–∫–µ–Ω–∞
3. –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ downstream-—Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏

**–†–æ–ª–∏**:
- `USER` - –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤)
- `ADMIN` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏)
- `CARRIER` - –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º–∏ —Ä–µ–π—Å–∞–º–∏)

---

## üóÑ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

| –°–µ—Ä–≤–∏—Å | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-------------|------------|
| Trip Service | PostgreSQL | –†–µ–π—Å—ã, –º–∞—Ä—à—Ä—É—Ç—ã |
| Booking Service | PostgreSQL | –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è |
| Inventory Service | PostgreSQL + Redis | –ú–µ—Å—Ç–∞ (PostgreSQL), –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ (Redis) |
| Order Service | PostgreSQL | –ó–∞–∫–∞–∑—ã |
| Payment Service | PostgreSQL | –ü–ª–∞—Ç–µ–∂–∏ |
| User Service | PostgreSQL | –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

---

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Client    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ API Gateway ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                                     ‚îÇ
       ‚ñº                                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Booking   ‚îÇ                    ‚îÇ    Trip    ‚îÇ
‚îÇ   Service   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ REST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  Service   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ gRPC ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ               ‚îÇ  Inventory  ‚îÇ
       ‚îÇ               ‚îÇ   Service   ‚îÇ
       ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                      ‚îÇ
       ‚îÇ                      ‚îÇ Kafka Events
       ‚îÇ                      ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ REST ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ               ‚îÇ    Order    ‚îÇ
       ‚îÇ               ‚îÇ   Service   ‚îÇ
       ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                      ‚îÇ
       ‚îÇ                      ‚îÇ Kafka Events
       ‚îÇ                      ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ REST ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ               ‚îÇ   Payment   ‚îÇ
       ‚îÇ               ‚îÇ   Service   ‚îÇ
       ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                      ‚îÇ
       ‚îÇ                      ‚îÇ Stripe Webhook
       ‚îÇ                      ‚îÇ
       ‚îÇ                      ‚ñº
       ‚îÇ               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ               ‚îÇ   Stripe    ‚îÇ
       ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ Kafka Events
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Kafka    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up -d
```

–°–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ—Ä—Ç–∞—Ö:
- API Gateway: `http://localhost:8080`
- Booking Service: `http://localhost:8081`
- Order Service: `http://localhost:8082`
- Payment Service: `http://localhost:8085`
- Trip Service: `http://localhost:8086`
- Inventory Service: `http://localhost:8080` (gRPC: `9090`)
- User Service: `http://localhost:8084`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Å–æ–±—ã—Ç–∏—è Kafka –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Redis TTL
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è rollback (–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π, –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤)
- Payment Service –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –Ω–∞–ø—Ä—è–º—É—é –æ—Ç Order Service - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ Kafka —Å–æ–±—ã—Ç–∏—è
